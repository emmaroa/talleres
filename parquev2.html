<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Parque Vehicular</title>
  <style>
    /* ===== Est√©tica Naranja + Turquesa (UI kit) ===== */
    :root{
      --bg: #f8f6f2;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;

      --brand: #ff7f11;        /* Naranja institucional */
      --brand-600: #e66e0a;
      --accent: #10c6d1;       /* Turquesa acento */
      --accent-700: #0ea5b0;

      --ring: rgba(16,198,209,.45);
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --shadow-strong: 0 16px 40px rgba(0,0,0,.12);
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 110% -10%, rgba(16,198,209,.10), transparent 60%),
        radial-gradient(900px 500px at -10% 110%, rgba(255,127,17,.10), transparent 60%),
        var(--bg);
    }

    /* ===== Header ===== */
    header{
      background: linear-gradient(135deg, var(--brand) 0%, var(--accent) 100%);
      color: white; box-shadow: var(--shadow);
    }
    .hero{
      max-width: 1100px; margin: 0 auto; padding: 24px 16px;
      display:flex; align-items:center; gap:16px; flex-wrap: wrap;
    }
    .logo{
      width:56px; height:56px; border-radius:12px; background: rgba(255,255,255,.15);
      display:grid; place-items:center; box-shadow: inset 0 0 0 1px rgba(255,255,255,.25); overflow:hidden;
    }
    .logo img{ width: 44px; height:auto; filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
    .titles h1{ margin:0; font-weight: 900; letter-spacing:.3px; font-size: clamp(1.1rem, 3vw, 1.6rem); }
    .titles p{ margin:.25rem 0 0; opacity:.95; }

    /* ===== Main / Card ===== */
    main{ display:grid; place-items:center; padding: 26px 16px 36px; }
    .card{
      width: 100%; max-width: 1100px;
      background: color-mix(in srgb, var(--card) 85%, #fff 15%);
      border: 1px solid rgba(16,198,209,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: saturate(1.05) blur(2px);
      overflow: clip;
    }
    .card-head{
      display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;
      padding: 16px 18px; border-bottom:1px solid rgba(16,198,209,.12);
      background: linear-gradient(180deg, rgba(16,198,209,.10), transparent);
    }
    .card-head h2{ margin:0; font-size:1.05rem; color:#0f172a; }
    .meta{ color: var(--muted); font-size:.9rem; }

    .controls{
      padding: 14px 18px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;
    }
    .control{
      position: relative; flex: 1 1 340px; min-width: 220px;
    }
    .control input{
      width: 100%; border:1px solid #e5e7eb; border-radius:12px; padding: 12px 14px 12px 40px; font-size:1rem; background:#fff;
      outline: none; transition: border-color .2s, box-shadow .2s;
    }
    .control input:focus{ border-color: var(--accent-700); box-shadow: 0 0 0 4px var(--ring); }
    .control .icon{
      position:absolute; left:12px; top:50%; translate: 0 -50%; font-size:1rem; color: var(--muted);
    }

    /* ===== Table ===== */
    .table-wrap{ padding: 0 18px 18px; }
    .scroller{
      border:1px solid #e5e7eb; border-radius:12px; overflow: auto; background:#fff;
      max-height: 60vh;
    }
    table{ width:100%; border-collapse: separate; border-spacing: 0; }
    thead th{
      position: sticky; top: 0; z-index: 1;
      background: linear-gradient(180deg, rgba(16,198,209,.10), #fff);
      border-bottom:1px solid #e5e7eb;
      text-align:left; padding:10px 12px; font-size:.92rem; color:#0f172a; font-weight:800;
    }
    tbody td{
      border-bottom:1px solid #f1f5f9; padding:10px 12px; font-size:.95rem;
    }
    tbody tr:hover{ background: rgba(16,198,209,.04); }
    tbody tr:last-child td{ border-bottom:0; }

    .hl{ background: linear-gradient(transparent 30%, rgba(16,198,209,.35) 30%, rgba(16,198,209,.35) 70%, transparent 70%); }

    /* ===== States ===== */
    .state{ padding: 10px 18px; color: var(--muted); }
    .badge{
      display:inline-block; padding:4px 10px; border-radius:999px; font-weight:800; font-size:.78rem;
      background: rgba(255,127,17,.12); color:#4a2a06; border:1px solid rgba(255,127,17,.35);
    }

    /* Footer */
    footer{ text-align:center; padding: 22px 16px; color:#fff; background: linear-gradient(135deg, var(--brand) 0%, var(--accent) 100%); }
    footer small{ opacity:.95; }

    @media (prefers-reduced-motion: reduce){
      .control input, .tile, .card{ transition: none; }
    }
  </style>
</head>
<body>
  <header>
    <div class="hero">
      <div class="logo">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Escudo_de_Hermosillo.svg/509px-Escudo_de_Hermosillo.svg.png" alt="Escudo de Hermosillo">
      </div>
      <div class="titles">
        <h1>Consulta de Parque Vehicular</h1>
        <p>Direcci√≥n de Talleres ¬∑ Municipio de Hermosillo</p>
      </div>
    </div>
  </header>

  <main>
    <section class="card" aria-labelledby="title">
      <div class="card-head">
        <h2 id="title">B√∫squeda r√°pida</h2>
        <div class="meta">
          <span id="totalBadge" class="badge">Cargando‚Ä¶</span>
        </div>
      </div>

      <div class="controls">
        <div class="control">
          <span class="icon">üîé</span>
          <input id="searchBox" type="text" placeholder="Escribe N√∫m. Econ√≥mico, descripci√≥n o dependencia‚Ä¶" autocomplete="off" />
        </div>
      </div>

      <div class="table-wrap">
        <div class="scroller" id="scroller">
          <table role="table" aria-describedby="title">
            <thead>
              <tr>
                <th style="width: 180px;">N√∫mero Econ√≥mico</th>
                <th>Descripci√≥n</th>
                <th style="width: 260px;">Dependencia</th>
              </tr>
            </thead>
            <tbody id="dataTable">
              <tr><td colspan="3" class="state">Cargando datos‚Ä¶</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="state" id="statusText"></div>
    </section>
  </main>

  <footer>
    <small>&copy; 2024 Direcci√≥n de Talleres ¬∑ Municipio de Hermosillo</small>
  </footer>

  <script>
    // ====== Config (misma hoja) ======
    const apiKey = 'AIzaSyDM8m9-bZM2stDAt1V0i-H-iStD0Vi6Z7k';
    const sheetId = '1jjWtlbLhO4BGqGJKWyXneb4r2WbcFBqDDcb9rEh8J8c';
    const range = 'A1:C';
    const apiUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`;

    // ====== Helpers ======
    const $ = (id) => document.getElementById(id);
    const table = $('dataTable');
    const badge = $('totalBadge');
    const statusText = $('statusText');
    const searchBox = $('searchBox');

    // Quitar tildes y normalizar
    const norm = (s) => (s || '')
      .toString()
      .normalize('NFD').replace(/\p{Diacritic}/gu,'')
      .toLowerCase().trim();

    // Resaltar coincidencias simples
    function highlight(text, query){
      if(!query) return text;
      const nText = norm(text);
      const nQuery = norm(query);
      const idx = nText.indexOf(nQuery);
      if(idx < 0) return text;
      // Reconstruir conservando el texto original
      const start = [...text].slice(0, [...nText].slice(0, idx).join('').length).join('');
      const match = text.substr(start.length, query.length);
      const end = text.substr(start.length + match.length);
      return `${start}<span class="hl">${match}</span>${end}`;
    }

    // Renderiza filas
    function renderTable(rows, query=''){
      table.innerHTML = '';
      if(!rows.length){
        table.innerHTML = `<tr><td colspan="3" class="state">Sin resultados para ‚Äú${query}‚Äù.</td></tr>`;
        return;
      }
      const frag = document.createDocumentFragment();
      rows.forEach(r => {
        const [econ, desc, dep] = [r[0] || '', r[1] || '', r[2] || ''];
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${highlight(econ, query)}</td>
          <td>${highlight(desc, query)}</td>
          <td>${highlight(dep, query)}</td>
        `;
        frag.appendChild(tr);
      });
      table.appendChild(frag);
    }

    // Filtra sobre 3 columnas
    function filterRows(allRows, query){
      if(!query) return allRows;
      const q = norm(query);
      return allRows.filter(r => {
        const econ = norm(r[0] || '');
        const desc = norm(r[1] || '');
        const dep  = norm(r[2] || '');
        return econ.includes(q) || desc.includes(q) || dep.includes(q);
      });
    }

    // Debounce
    function debounce(fn, ms=200){
      let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
    }

    // ====== Datos en memoria ======
    let ALL = []; // sin encabezados

    async function fetchData(){
      try{
        badge.textContent = 'Cargando‚Ä¶';
        statusText.textContent = '';
        const resp = await fetch(apiUrl);
        const json = await resp.json();
        const values = json.values || [];
        if(values.length <= 1){
          badge.textContent = '0 registros';
          renderTable([]);
          statusText.textContent = 'Hoja sin datos o rango fuera de A1:C.';
          return;
        }
        ALL = values.slice(1); // quitar encabezados
        badge.textContent = `${ALL.length} registros`;
        renderTable(ALL);
      }catch(e){
        console.error(e);
        badge.textContent = 'Error';
        table.innerHTML = `<tr><td colspan="3" class="state">Error al cargar la hoja.</td></tr>`;
        statusText.textContent = 'Verifica API key, Sheet ID y permisos p√∫blicos de lectura.';
      }
    }

    const handleSearch = debounce(() => {
      const q = searchBox.value;
      const filtered = filterRows(ALL, q);
      badge.textContent = `${filtered.length} de ${ALL.length}`;
      renderTable(filtered, q);
      statusText.textContent = q ? `Filtrado por ‚Äú${q}‚Äù` : '';
    }, 220);

    searchBox.addEventListener('input', handleSearch);

    // Init
    fetchData();
  </script>
</body>
</html>
